INSERT INTO `entidad` VALUES (1,'Registraduria de Florencia Caqueta','899999040-4','321000111','A 15-110, Cl. 15 #15-2','registra@gmail.com','ACTIVA','FLORENCIA','PRINCIPAL'),(2,'Registraduria Alabania','899999040-4','3168328273','Calle 5 No. 3-24 Barrio Centro','albaniacaqueta@registraduria.gov.co','ACTIVA','ALBANIA','SEDE'),(4,'Registraduria Belen de los Andaquies','899999040-4','3112540424','Carrera 6 No 5-47 Barrio Cincuentario','belendelosandaquies@registraduria.gov.co','ACTIVA','BELEN','SEDE'),(5,'Registraduria Cartagena del Chaira','899999040-4','3168323236','Calle 3 No. 2-15 Barrio Centro','cartagenadelchaira@registraduria.gov.co','ACTIVA','CARTAGENA','SEDE'),(6,'Registraduria Curillo','899999040-4','3173642997','Calle 10 No. 3-19 Barrio Centro','curillocaqueta@registraduria.gov.co','ACTIVA','CURILLO','SEDE'),(7,'Registraduria El Doncello','899999040-4','3166934964','Calle 3 No. 5-44 Barrio Simon Bolivar','eldoncellocaqueta@registraduria.gov.co','ACTIVA','DONCELLO','SEDE'),(8,'Registraduria El Paujil','899999040-4','3183597026','Calle 5 No. 3-29','elpaujilcaqueta@registraduria.gov.co','ACTIVA','PAUJIL','SEDE'),(9,'Registraduria La Montañita','899999040-4','4300099','Calle 6 No. 4-43 Barrio El Centro','lamontanitacaqueta@registraduria.gov.co','ACTIVA','MONTAÑITA','SEDE'),(10,'Registraduria Milan','899999040-4','4351646 - Ext 103','Cra 7 No. 3-44','milancaqueta@registraduria.gov.co','ACTIVA','MILAN','SEDE'),(11,'Registraduria Morelia','899999040-4','3188432103','Calle 3 No. 2-16 / 24','moreliacaqueta@registraduria.gov.co','ACTIVA','MORELIA','SEDE'),(12,'Registraduria Puerto Rico','899999040-4','3168323694','Calle 4 No. 4-43 Carrio El Comercio','puertoricocaqueta@registraduria.gov.co','ACTIVA','PUERTO RICO','SEDE'),(13,'Registraduria San Jose del Fragua','899999040-4','3162700192','Cra 6 No 4-06','sanjosedelfragua@registraduria.gov.co','ACTIVA','SAN JOSE DEL FRAGUA','SEDE'),(14,'Registraduria Solano','899999040-4','3153438114','Cra 4 No. 6-58','solanocaqueta@registraduria.gov.co','ACTIVA','SOLANO','SEDE'),(15,'Registraduria Solita','899999040-4','4351646 - Ext 103','Cra 4 No. 2-25','solitacaqueta@registraduria.gov.co','ACTIVA','SOLITA','SEDE'),(16,'Registraduria Valparaiso','899999040-4','3165211549','Calle 11 No. 5-18','valparaisocaqueta@registraduria.gov.co','ACTIVA','VALPARAISO','SEDE');

INSERT INTO `identificacion` VALUES (1,'CEDULA DE CIUDADANIA','ACTIVO'),(2,'TARJETA DE IDENTIFICACION','ACTIVO');

INSERT INTO `persona` VALUES (1,1,'1117546877','Socrates','Berrio','soc.martinez@udla.edu.co','3212586973'),(4,1,'900304060','Laura','Dayana','laura@registraduria.com','3212004050'),(5,1,'899999041','Registraduria','Albania','albaniacaqueta@registraduria.gov.co','3168328273'),(6,1,'899999042','Registraduria','Belen de los Andaquies','belendelosandaquies@registraduria.gov.co','3112540424'),(7,1,'899999043','Registraduria','Cartagena del Chaira','cartagenadelchaira@registraduria.gov.co','3168323236'),(8,1,'899999044','Registraduria','Curillo','curillocaqueta@registraduria.gov.co','3173642997'),(9,1,'899999045','Registraduria','El Doncello','eldoncellocaqueta@registraduria.gov.co','3166934964'),(10,1,'899999046','Registraduria','El Paujil','elpaujilcaqueta@registraduria.gov.co','3183597026'),(11,1,'899999047','Registraduria','La Montañita','lamontanitacaqueta@registraduria.gov.co','4300099'),(12,1,'899999048','Registraduria','Milan','milancaqueta@registraduria.gov.co','4351646 - Ext 103'),(13,1,'899999049','Registraduria','Morelia','moreliacaqueta@registraduria.gov.co','3188432103'),(14,1,'899999050','Registraduria','Puerto Rico','puertoricocaqueta@registraduria.gov.co','3168323694'),(15,1,'899999051','Registraduria','San Jose del Fragua','sanjosedelfragua@registraduria.gov.co','3162700192'),(16,1,'899999052','Registraduria','Solano','solanocaqueta@registraduria.gov.co','3153438114'),(17,1,'899999053','Registraduria','Solita','solitacaqueta@registraduria.gov.co','4351646 - Ext 103'),(18,1,'899999054','Registraduria','Valparaiso','valparaisocaqueta@registraduria.gov.co','3165211549');

INSERT INTO `usuario` VALUES (1,'1117546877','$2a$10$9l3ZKHCicEQIHB9v..h5TONqeHPJ8N9Sy8rgu4cskSmg.OoJC8Vfy',1),(2,'900304060','$2a$10$CtEG7BFaE724RmQoaNv3PePlOWPkPdcwBRXcBi078mvAC4NO3t45W',4),(3,'899999041','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',5),(4,'899999042','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',6),(5,'899999043','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',7),(6,'899999044','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',8),(7,'899999045','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',9),(8,'899999046','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',10),(9,'899999047','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',11),(10,'899999048','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',12),(11,'899999049','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',13),(12,'899999050','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',14),(13,'899999051','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',15),(14,'899999052','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',16),(15,'899999053','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',17),(16,'899999054','$2a$10$mtDkUKtRrxfN5XJn621dI.2FmwRMub4ugru5qXDFJZbAXN3R2TyKq',18);

INSERT INTO `menu` VALUES (1,'fa fa-home','Inicio','/supadmin/home',1),(2,'fa fa-users','Registro','/supadmin/registro',2),(3,'fa fa-desktop','Inicio','/admin/inicio',1),(4,'fa fa-archive','Bodega','/supadmin/bodega',3),(5,'fa fa-dropbox','Inventario','/admin/inventario',3),(6,'fa fa-file','Peticiones','/admin/peticiones',4),(7,'fa fa-cog','Acciones','#accio',5),(8,'fa fa-times','Restricciones','/admin/restricciones',6),(9,'fa fa-plus','Registros','/admin/registros',2),(10,'fa fa-times','Adiciones','/admin/adiciones',7);

INSERT INTO `rol` VALUES (1,'SUPER ADMINISTRADOR','ADMIN'),(2,'EMPLEADO','ADMIN'),(3,'PASANTE','PROFESIONAL'),(4,'ENTIDAD','ADMIN');

INSERT INTO `permisos` VALUES (1,1,1),(2,1,2),(3,2,3),(4,1,4),(5,2,5),(6,2,6),(7,2,7),(8,2,8),(9,2,9),(10,3,3),(11,3,4),(12,3,5),(13,3,6),(14,2,10),(15,4,1);

INSERT INTO `proveedor` VALUES (1,'SUMIMAS','830001338-1','Clle 15 No 15-20 Barrio Centro','3005112020','ACTIVO');

INSERT INTO `registro_ep` VALUES (1,'2021-05-03 16:11:11','ACTIVA',1,1,1),(3,'2021-05-12 21:53:02','ACTIVA',1,4,2),(4,'2021-06-08 16:11:11','ACTIVA',2,5,4),(5,'2021-06-08 16:11:11','ACTIVA',4,6,4),(6,'2021-06-08 16:11:11','ACTIVA',5,7,4),(7,'2021-06-08 16:11:11','ACTIVA',6,8,4),(8,'2021-06-08 16:11:11','ACTIVA',7,9,4),(9,'2021-06-08 16:11:11','ACTIVA',8,10,4),(10,'2021-06-08 16:11:11','ACTIVA',9,11,4),(11,'2021-06-08 16:11:11','ACTIVA',10,12,4),(12,'2021-06-08 16:11:11','ACTIVA',11,13,4),(13,'2021-06-08 16:11:11','ACTIVA',12,14,4),(14,'2021-06-08 16:11:11','ACTIVA',13,15,4),(15,'2021-06-08 16:11:11','ACTIVA',14,16,4),(16,'2021-06-08 16:11:11','ACTIVA',15,17,4),(17,'2021-06-08 16:11:11','ACTIVA',16,18,4);

INSERT INTO `tipo_producto` VALUES (1,'PAPELERIA','PRODUCTOS COMO LAPICES, RESMAS DE PAPEL O INSTRUMENTOS PARA IMPRESION O ESCRIBIR','ACTIVO'),(2,'ASEO','PRODUCTOS PARA LA LIMPIEZA E HIGENE','ACTIVO'),(3,'CAFETERIA','PRODUCTOS DE CONSUMO PERSONAL','ACTIVO'),(4,'ELECTRONICOS','PRODUCTOS DE RELACIONADOS CON ELEMENTOS ELECTRICOS DESDE TONER HASTA TECLADOS Y MOUSES','ACTIVO');

INSERT INTO `bodega` VALUES (1,'BD-01','INSUMOS RAPIDOS','PEQUEÑA','ACTIVA',1),(2,'BD-02','BODEGA','GRANDE','ACTIVA',1);

delimiter //
create trigger t_aud_productos_ai
after insert on epis.producto
for each row
begin 
	declare cambios TEXT;
    set cambios = concat('Id_Producto: ',new.Id_Producto,', Cod_Producto : ',new.Cod_Producto,', Nombre: ',new.Nombre,', Cantidad_Producto: ',new.Cantidad_Producto,', Estado: ', new.Estado,', inf_registro : ',new.inf_registro);
	insert into aud_productos values (default, user(), now(), cambios);
end;
//

delimiter //
create trigger t_aud_productos_au
after update on epis.producto
for each row
begin 
	declare cambios TEXT;
    set cambios = concat('Id_Producto: ',OLD.Id_Producto,', Cod_Producto : ',OLD.Cod_Producto,', Nombre: ',OLD.Nombre,', Cantidad_Producto: ',OLD.Cantidad_Producto,', Estado: ', OLD.Estado,', inf_registro : ',OLD.inf_registro);
	insert into aud_productos values (default, user(), now(), cambios);
end;
//

delimiter //
create trigger t_aud_aud_restricciones_ai
after insert on epis.restricciones 
for each row
begin 
	declare cambios TEXT;
    set cambios = concat('Cantidad: ',new.Cantidad,', Detalle: ',new.Detalle,', Estado: ',new.Estado,', Producto_id_Producto: ', new.Producto_id_Producto);
	insert into aud_empleado values (default, user(), now(), cambios);
end;
//

delimiter //
create trigger t_aud_aud_restricciones_au
after update on epis.restricciones 
for each row
begin 
	declare cambios TEXT;
    set cambios = concat('Cantidad: ',OLD.Cantidad,', Detalle: ',OLD.Detalle,', Estado: ',OLD.Estado,', Producto_id_Producto: ', OLD.Producto_id_Producto);
	insert into aud_empleado values (default, user(), now(), cambios);
end;
//

delimiter //
create trigger t_aud_inventario_ai
after insert on epis.inventario
for each row
begin 
	declare cambios TEXT;
    set cambios = concat('Cod_Inventario: ',new.Cod_Inventario,', Cantidad: ',new.Cantidad,', Fecha_Registro:',new.Fecha_Registro);
	insert into aud_inventario values (default, user(), now(), cambios);
end;
//

delimiter //
create trigger t_aud_inventario_au
after update on epis.inventario
for each row
begin 
	declare cambios TEXT;
    set cambios = concat('Cod_Inventario: ',OLD.Cod_Inventario,', Cantidad: ',OLD.Cantidad,', Fecha_Registro:',OLD.Fecha_Registro,' -- POR: ',' Cantidad: ',new.Cantidad);
	insert into aud_inventario values (default, user(), now(), cambios);
end;
//

delimiter //
create trigger t_aud_pedidos_ai
after insert on epis.pedidos
for each row
begin 
	declare cambios TEXT;
    set cambios = concat('Entidad_id_Entidad: ',new.Entidad_id_Entidad,', Fecha_Pedido : ',new.Fecha_Pedido,', Fecha_Atendido: ',new.Fecha_Atendido,', Estado: ',new.Estado);
	insert into aud_pedidos values (default, user(), now(), cambios);
end;
//

delimiter //
create trigger t_aud_pedidos_au
after update on epis.pedidos
for each row
begin 
	declare cambios TEXT;
    set cambios = concat('Entidad_id_Entidad: ',OLD.Entidad_id_Entidad,', Fecha_Pedido : ',OLD.Fecha_Pedido,', Fecha_Atendido: ',OLD.Fecha_Atendido,', Estado: ',OLD.Estado);
	insert into aud_pedidos values (default, user(), now(), cambios);
end;
//

CREATE DEFINER=`root`@`localhost` PROCEDURE `Actualizacion_Producto`(IN Tipo_Producto INT, Codigo_Producto VARCHAR(65), Nombre_Producto VARCHAR(65), Descripcion_Producto VARCHAR(250), Bodega1 INT, Bodega2 INT, Id_Producto INT)
begin 		
	declare Cantidads int;
	
	set Cantidads = bodega1 + bodega2;
	
	update producto set producto.Tipo_Producto_id_Tipo_Producto = Tipo_Producto, producto.Cod_Producto = Codigo_Producto, producto.Nombre = Nombre_Producto, producto.Descripcion = Descripcion_Producto, producto.Cantidad_Producto = Cantidads where producto.id_Producto = Id_Producto;

	if Bodega1 != 0 then
	update inventario set inventario.Cantidad = Bodega1 where inventario.Producto_id_Producto = Id_Producto and inventario.Bodega_id_Bodega = 1;
	end if;

	if Bodega2 != 0 then
	update inventario set inventario.Cantidad = Bodega2 where inventario.Producto_id_Producto = Id_Producto and inventario.Bodega_id_Bodega = 2;
	end if;

end

CREATE DEFINER=`root`@`localhost` PROCEDURE `Actualizar_Inventario`(IN Id_Inven INT, Valor_Inventario INT)
begin 			
	declare Valor1 int;
	declare Valor2 int;
	declare Valor3 int;
	declare Cantidad int;
	declare Id_Producto int;
	
	select inventario.Producto_id_Producto into Id_Producto from inventario where inventario.id_Inventario = Id_Inven;

	select producto.Cantidad_Producto into Valor1 from producto where producto.id_Producto = Id_Producto;

	select inventario.Cantidad into Valor2 from inventario where inventario.id_Inventario = Id_Inven;
	
	set Valor3 = Valor2 - Valor_Inventario;

	set Cantidad = Valor1 - Valor3;

	update producto set producto.Cantidad_Producto = Cantidad where producto.id_Producto = Id_Producto;

	update inventario set inventario.Cantidad = Valor_Inventario where inventario.id_Inventario = Id_Inven;
			
end

CREATE DEFINER=`root`@`localhost` PROCEDURE `Despacho_Unitario_Producto`(IN Id_Producto INT, Id_Inventario INT, Cantidad_Inventario INT, Cantidad_Pedido INT)
begin 			
	declare Resta int;
	declare CanProducto int;
	declare Cantidad int;	
	
	set Resta = Cantidad_Inventario - Cantidad_Pedido;
	
	select producto.Cantidad_Producto into CanProducto from producto where producto.id_Producto = Id_Producto;
	
	set Cantidad = CanProducto - Cantidad_Pedido;

	update inventario set inventario.Cantidad = Resta where inventario.id_Inventario = Id_Inventario;

	update producto set producto.Cantidad_Producto = Cantidad where producto.id_Producto = Id_Producto;
			
end

CREATE DEFINER=`root`@`localhost` PROCEDURE `Registro_Productos`(IN Tipo_Producto INT, Codigo_Producto VARCHAR(65), Nombre_Producto VARCHAR(65), Descripcion_Producto VARCHAR(250), Bodega_1 INT, Bodega_2 INT)
begin 			
	declare Cantidad int;
	declare Id_Product int;
	
	set Cantidad = Bodega_1 + Bodega_2;
	
	if Bodega_1 >= 1 and Bodega_2 < 1 then 
	INSERT INTO `producto` (`id_Producto`, `Tipo_Producto_id_Tipo_Producto`, `Cod_Producto`, `Nombre`, `Cantidad_Producto`, `Descripcion`, `Estado`, `inf_registro`, `Proveedor_id_Proveedor`) VALUES
	(default, Tipo_Producto, Codigo_Producto, Nombre_Producto, Cantidad, Descripcion_Producto, 'DISPONIBLE', 2, 1);
	elseif Bodega_1 < 1 and Bodega_2 >= 1 then 
	INSERT INTO `producto` (`id_Producto`, `Tipo_Producto_id_Tipo_Producto`, `Cod_Producto`, `Nombre`, `Cantidad_Producto`, `Descripcion`, `Estado`, `inf_registro`, `Proveedor_id_Proveedor`) VALUES
	(default, Tipo_Producto, Codigo_Producto, Nombre_Producto, Cantidad, Descripcion_Producto, 'DISPONIBLE', 3, 1);
	else
	INSERT INTO `producto` (`id_Producto`, `Tipo_Producto_id_Tipo_Producto`, `Cod_Producto`, `Nombre`, `Cantidad_Producto`, `Descripcion`, `Estado`, `inf_registro`, `Proveedor_id_Proveedor`) VALUES
	(default, Tipo_Producto, Codigo_Producto, Nombre_Producto, Cantidad, Descripcion_Producto, 'DISPONIBLE', 1, 1);
	end if;
	
	select producto.id_Producto into Id_Product from producto where producto.Cod_Producto = Codigo_Producto;
		
	if Bodega_1 > 0 then
	insert into `inventario` (`id_Inventario`, `Cod_Inventario`, `Cantidad`, `Fecha_Registro`,`Bodega_id_Bodega`, `Producto_id_Producto`) values
	(default, Codigo_Producto, Bodega_1, now(), 1, Id_Product);
	end if;	
	
	if Bodega_2 > 0 then
	insert into `inventario` (`id_Inventario`, `Cod_Inventario`, `Cantidad`, `Fecha_Registro`,`Bodega_id_Bodega`, `Producto_id_Producto`) values
	(default, Codigo_Producto, Bodega_2, now(), 2, Id_Product);
	end if;
			
end

CREATE DEFINER=`root`@`localhost` PROCEDURE `Registro_Usuarios`(IN NombreUsuario VARCHAR(65), ApellidoUsuario VARCHAR(65), Tidentificacion INT, Identifica VARCHAR(65), TelefonoUsuario VARCHAR(65), CorreoUsuario VARCHAR(65), Contrasena VARCHAR(65), TipoUsuario INT)
begin 			
	declare Id_Entidad int;
	declare Id_Persona int;
	
	set Id_Entidad = 1;

	INSERT INTO `persona` (`id_Persona`, `Identificacion_id_Identificacion`, `Identificacion`, `Nombre`, `Apellido`, `Correo_Electronico`, `Telefono`) VALUES
	(default, Tidentificacion, Identifica, NombreUsuario, ApellidoUsuario, CorreoUsuario, TelefonoUsuario);

	select persona.id_Persona into Id_Persona from persona where persona.Identificacion = Identifica;
		
	INSERT INTO `registro_ep` (`id_Registro_EP`, `Fecha`, `Estado`, `Entidad_id_Entidad`, `Persona_id_Persona`, `Rol_Id_Rol`) VALUES
	(default, now(), 'ACTIVA', Id_Entidad, Id_Persona, TipoUsuario);
	
	INSERT INTO `usuario` (`id_Usuario`, `Usuario`, `Password`, `Persona_id_Persona`) VALUES
	(default, Identifica, Contrasena, Id_Persona);
			
end